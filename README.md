# 作業時間記録ツール - ユーザーマニュアル

## 概要

作業時間記録ツールは、プロジェクトやタスクの作業時間を効率的に記録・管理するためのWebアプリケーションです。オーダー（プロジェクト）とアクティビティ（タスク）を階層的に管理し、正確な時間計測とレポート機能を提供します。

## 主な機能

- **オーダー管理**: プロジェクトやクライアント単位での作業管理
- **アクティビティ管理**: 具体的なタスクや作業内容の管理
- **時間計測**: リアルタイムでの作業時間計測
- **レポート機能**: 日別・週別・月別の作業時間集計
- **データエクスポート**: CSV形式でのデータ出力
- **データインポート**: JSON形式でのデータ取り込み
- **データ永続化**: ブラウザのLocalStorageを使用した自動保存

## 使い方

### 1. 初期設定

#### オーダーの作成
1. 「新規オーダー」ボタンをクリック
2. オーダー名を入力（必須）
3. 説明を入力（任意）
4. 「作成」ボタンをクリック

#### アクティビティの作成
1. オーダーリストから対象のオーダーを選択
2. 「新規アクティビティ」ボタンをクリック
3. アクティビティ名を入力（必須）
4. 説明を入力（任意）
5. 「作成」ボタンをクリック

### 2. 作業時間の記録

#### 作業開始
1. オーダーリストから作業対象のオーダーを選択
2. アクティビティグリッドから開始したいアクティビティをクリック
3. タイマーが自動的に開始され、画面上部に経過時間が表示されます
4. 「作業終了」ボタンが有効になります

#### 作業終了
1. 「作業終了」ボタンをクリック
2. 作業セッションが自動的に保存されます
3. タイマーが停止し、アクティビティの状態が更新されます

#### 作業の切り替え
- 作業中に別のアクティビティをクリックすると、現在の作業を自動的に終了し、新しい作業を開始します

### 3. レポートの確認

#### 作業履歴の表示
1. 「作業履歴」ボタンをクリック
2. 最近の作業セッション一覧が表示されます
3. 各セッションの開始時刻、終了時刻、作業時間が確認できます

#### 期間別レポート
1. 対象日付を選択（デフォルトは今日）
2. 選択した日付の作業時間集計が表示されます
3. オーダー別、アクティビティ別の内訳も確認できます

### 4. データのエクスポート・インポート

#### CSVエクスポート
1. 「エクスポート」ボタンをクリック
2. エクスポートメニューから以下のいずれかを選択：
   - **作業履歴 (CSV)**: 全ての作業セッションの詳細データ
   - **集計サマリー (CSV)**: オーダー別の作業時間集計

#### JSONインポート
1. 「インポート」ボタンをクリック
2. JSONファイルを選択またはドラッグ&ドロップ
3. データの検証が自動的に実行されます
4. 重複データの処理方法を選択：
   - **スキップ**: 重複データを無視
   - **上書き**: 既存データを新しいデータで置き換え
   - **マージ**: 既存データを保持し、新しいデータで補完
5. 「インポート実行」ボタンをクリック

#### 印刷
1. 「エクスポート」ボタンをクリック
2. 「レポート印刷」を選択
3. 印刷用ページが新しいウィンドウで開きます

### 5. データの編集・削除

#### オーダーの編集
1. オーダーリストの対象オーダーをダブルクリック
2. または右クリックして編集メニューを選択
3. 編集フォームで内容を変更し、「更新」をクリック

#### アクティビティの編集
1. アクティビティグリッドの対象アクティビティをダブルクリック
2. または右クリックして編集メニューを選択
3. 編集フォームで内容を変更し、「更新」をクリック

#### 削除
- 編集フォーム内の「削除」ボタンをクリック
- 削除されたデータは復元できませんので注意してください

## 注意事項

### データの保存について
- **自動保存**: 作業開始・終了時に自動的にデータが保存されます
- **保存場所**: ブラウザのLocalStorageに保存されます
- **ブラウザ依存**: データは使用しているブラウザにのみ保存されます

### ブラウザ制限
- **プライベートブラウジング**: プライベート/シークレットモードでは正常に動作しない場合があります
- **容量制限**: LocalStorageには容量制限があります（通常5-10MB）
- **ブラウザ変更**: 異なるブラウザでは同じデータにアクセスできません

### 作業時間の計測
- **精度**: 1秒単位で計測されます
- **異常検知**: 24時間を超える連続作業は警告が表示されます
- **ブラウザ終了**: ブラウザを閉じても作業中のセッションは保持されます

### データの整合性
- **バックアップ推奨**: 定期的なCSVエクスポートによるバックアップを推奨します
- **データ検証**: アプリケーション起動時に自動的にデータの整合性がチェックされます
- **エラー時の対応**: データ破損が検出された場合、初期状態にリセットされます

## クリーンアップ方法

### 1. 作業データのクリーンアップ

#### 古いセッションの削除
現在のバージョンでは手動削除機能はありませんが、以下の方法で対応できます：

1. **CSVエクスポート**: 必要なデータを事前にエクスポート
2. **ブラウザ設定**: ブラウザの設定からLocalStorageをクリア
3. **再インポート**: 必要に応じて手動でデータを再入力

#### 不要なオーダー・アクティビティの削除
1. 対象のオーダーまたはアクティビティを編集
2. 編集フォーム内の「削除」ボタンをクリック
3. 関連する作業セッションも自動的に削除されます

### 2. ブラウザデータのクリーンアップ

#### LocalStorageの完全クリア
**Chrome/Edge:**
1. F12キーで開発者ツールを開く
2. 「Application」タブを選択
3. 「Local Storage」→ サイトURLを選択
4. `workTimeTracker` キーを削除

**Firefox:**
1. F12キーで開発者ツールを開く
2. 「ストレージ」タブを選択
3. 「ローカルストレージ」→ サイトURLを選択
4. `workTimeTracker` キーを削除

#### ブラウザ設定からのクリア
1. ブラウザの設定を開く
2. 「プライバシーとセキュリティ」を選択
3. 「閲覧データを削除」を選択
4. 「Cookieとその他のサイトデータ」にチェック
5. 対象期間を選択して削除実行

### 3. 定期メンテナンス

#### 推奨メンテナンススケジュール
- **週次**: 不要な作業セッションの確認
- **月次**: CSVエクスポートによるバックアップ
- **四半期**: 古いデータの整理とアーカイブ

#### パフォーマンス最適化
- 大量のデータが蓄積された場合、動作が重くなる可能性があります
- 定期的なデータ整理により、快適な動作を維持できます

## インポート機能の詳細

### サポートされるファイル形式
- **ファイル形式**: JSON (.json)
- **最大ファイルサイズ**: 10MB
- **文字エンコーディング**: UTF-8

### JSONファイルの構造
```json
{
  "orders": [
    {
      "id": "order_1",
      "name": "プロジェクト名",
      "activities": [
        {
          "id": "activity_1",
          "name": "タスク名"
        },
        {
          "id": "activity_2",
          "name": "別のタスク名"
        }
      ]
    },
    {
      "id": "order2",
      "name": "テスト",
      "activities": []
    }
  ]
}
```

#### 構造の説明
- **orders**: プロジェクト（オーダー）の配列
  - **id**: 一意の識別子（必須）
  - **name**: プロジェクト名（必須）
  - **activities**: そのプロジェクトに属するタスクの配列（オプション）
    - **id**: 一意の識別子（必須）
    - **name**: タスク名（必須）

#### 自動生成される項目
- **createdAt**: 作成日時（インポート時に自動生成）
- **orderId**: アクティビティの親オーダーID（ネスト構造から自動設定）

### データ検証機能
インポート時に以下の検証が自動実行されます：

#### 必須フィールドの検証
- **オーダー**: id, name
- **アクティビティ**: id, name（ネスト構造内）

#### データ型の検証
- **id**: 文字列（最大100文字）
- **name**: 文字列（最大200文字）
- **activities**: 配列（オプション）

#### 整合性の検証
- ID の重複チェック（オーダー間、アクティビティ間）
- ネスト構造の妥当性チェック
- 自動的なフラット構造への変換と関係性の確立

### エラーハンドリング
インポート処理中にエラーが発生した場合、詳細なエラーレポートが表示されます：

#### エラーの種類
- **ファイル形式エラー**: サポートされていないファイル形式
- **JSON解析エラー**: 不正なJSON構文
- **データ検証エラー**: 必須フィールドの不足やデータ型の不一致
- **整合性エラー**: データ間の関係性の問題

#### 推奨される対処法
各エラーに対して具体的な解決方法が提示されます：
- ファイル形式の修正方法
- JSON構文の確認方法
- データ形式の修正方法
- 整合性問題の解決方法

### インポートのベストプラクティス

#### 事前準備
1. **バックアップ**: 既存データのCSVエクスポートを実行
2. **ファイル検証**: JSONバリデーターでファイル構文を確認
3. **小規模テスト**: 少量のデータで動作確認

#### データ品質の向上
1. **一意のID**: 重複しない一意のIDを使用
2. **適切な命名**: 分かりやすいオーダー・アクティビティ名
3. **階層構造**: オーダー内にアクティビティを適切にネスト

#### パフォーマンス最適化
1. **ファイルサイズ**: 大量データは分割してインポート
2. **ネスト構造**: 関連するアクティビティをオーダー内にまとめる
3. **重複処理**: 適切な重複処理オプションの選択

### テスト機能

#### 単体テスト
インポート機能には包括的な単体テストが実装されています：

- **JSON解析テスト**: 正常・異常なJSON形式の処理
- **データ検証テスト**: 各種検証ルールの動作確認
- **重複処理テスト**: 重複データの検出と処理
- **エラーハンドリングテスト**: エラー分類と適切なメッセージ生成
- **パフォーマンステスト**: 大量データの処理性能
- **エッジケーステスト**: 極端な条件での動作確認
- **ネスト構造変換テスト**: ネスト構造とフラット構造の相互変換

#### テストの実行
1. ブラウザの開発者ツールを開く
2. コンソールで `new ImportTest().runAllTests()` を実行
3. テスト結果がコンソールに表示されます

## トラブルシューティング

### よくある問題と解決方法

#### タイマーが動作しない
1. ブラウザのコンソールでエラーを確認
2. ページをリロード
3. 別のブラウザで試行

#### データが保存されない
1. プライベートブラウジングモードを無効にする
2. ブラウザのLocalStorage設定を確認
3. 十分な容量があることを確認

#### エクスポートが失敗する
1. ポップアップブロッカーを無効にする
2. ダウンロード設定を確認
3. 別のブラウザで試行

#### インポートが失敗する
1. **ファイル形式を確認**: .json拡張子のファイルを使用
2. **ファイルサイズを確認**: 10MB以下のファイルを使用
3. **JSON構文を確認**: JSONバリデーターで構文をチェック
4. **データ形式を確認**: 必須フィールドが含まれているか確認
5. **エラーメッセージを確認**: 詳細なエラー情報を参照

#### インポートデータが反映されない
1. **重複処理設定を確認**: 「スキップ」以外のオプションを選択
2. **データの整合性を確認**: 孤立したアクティビティがないか確認
3. **ブラウザをリロード**: ページを再読み込みして確認

#### インポート処理が遅い
1. **ファイルサイズを削減**: データを分割してインポート
2. **不要なデータを削除**: 必要最小限のデータのみインポート
3. **ブラウザのリソースを確認**: 他のタブやアプリケーションを閉じる

#### 画面が正しく表示されない
1. ブラウザのキャッシュをクリア
2. JavaScriptが有効になっていることを確認
3. 最新のブラウザを使用

## サポート情報

### 対応ブラウザ
- Chrome 80以降
- Firefox 75以降
- Safari 13以降
- Edge 80以降

### システム要件
- JavaScript有効
- LocalStorage対応
- 最低解像度: 1024x768

### データ形式
- **保存形式**: JSON（LocalStorage）
- **エクスポート形式**: CSV（UTF-8 BOM付き）
- **インポート形式**: JSON（UTF-8）
- **日時形式**: ISO 8601形式

### インポート機能の制限事項
- **ファイル形式**: JSONファイルのみサポート
- **最大ファイルサイズ**: 10MB
- **最大データ数**: オーダー10,000件、アクティビティ50,000件
- **文字数制限**: ID 100文字、名前200文字
- **日時範囲**: 1900年〜2100年

## 開発者向け情報

### テスト実行方法

#### インポート機能のテスト
```javascript
// ブラウザのコンソールで実行
const importTest = new ImportTest();
const results = importTest.runAllTests();
console.log('テスト結果:', results);
```

#### 個別テストの実行
```javascript
// JSON解析テストのみ実行
const importTest = new ImportTest();
importTest.testJSONParsing();

// データ検証テストのみ実行
importTest.testDataValidation();

// 重複チェックテストのみ実行
importTest.testDuplicateCheck();
```

#### インテグレーションテスト
```javascript
// サンプルデータでの統合テスト
const importTest = new ImportTest();
importTest.runIntegrationTest().then(result => {
    console.log('統合テスト結果:', result);
});
```

### カスタマイズ

#### 検証ルールの追加
`ImportService.validateImportData()` メソッドを拡張して、独自の検証ルールを追加できます。

#### エラーメッセージのカスタマイズ
`ImportErrorHandler` クラスの `errorMessages` マップを編集して、エラーメッセージをカスタマイズできます。

#### パフォーマンス調整
- `ImportService.estimateProcessingTime()`: 処理時間推定の調整
- `ImportService.estimateMemoryUsage()`: メモリ使用量推定の調整
- 各種制限値の変更（ファイルサイズ、データ数など）

---

このマニュアルは作業時間記録ツール v1.1 に対応しています。
最新の情報については、アプリケーション内のヘルプまたは開発者にお問い合わせください。